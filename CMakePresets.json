{
  "version": 6,
  "cmakeMinimumRequired": { "major": 3, "minor": 25, "patch": 0 },
  "configurePresets": [
    {
      "name": "base",
      "hidden": true,
      "binaryDir": "${sourceDir}/out/build/${presetName}",
      "cacheVariables": {
        "CMAKE_CXX_STANDARD": "20",
        "CMAKE_EXPORT_COMPILE_COMMANDS": "ON",
        "CMAKE_POLICY_DEFAULT_CMP0091": "NEW",
        "BUILD_TESTING": "ON",
        "VCPKG_FEATURE_FLAGS": "manifests"
      },
      "toolchainFile": "$env{VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake"
    },

    {
      "name": "dev-linux",
      "displayName": "Linux Dev (Ninja, vcpkg manifest)",
      "inherits": "base",
      "generator": "Ninja",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Debug",
        "VCPKG_TARGET_TRIPLET": "x64-linux"
      }
    },
    {
      "name": "release-linux",
      "displayName": "Linux Release (Ninja)",
      "inherits": "base",
      "generator": "Ninja",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Release",
        "VCPKG_TARGET_TRIPLET": "x64-linux"
      }
    },
    {
      "name": "ci-ninja",
      "displayName": "CI (Linux, Ninja)",
      "inherits": "release-linux",
      "cacheVariables": {
        "CMAKE_COMPILE_WARNING_AS_ERROR": "ON"
      }
    },

    {
      "name": "vs2022-win64",
      "displayName": "Windows VS2022 x64 (vcpkg manifest)",
      "inherits": "base",
      "generator": "Visual Studio 17 2022",
      "architecture": { "value": "x64" },
      "cacheVariables": {
        "VCPKG_TARGET_TRIPLET": "x64-windows"
      }
    },
    {
      "name": "ninja-win64",
      "displayName": "Windows Ninja Multi-Config (MSVC)",
      "inherits": "base",
      "generator": "Ninja Multi-Config",
      "cacheVariables": {
        "VCPKG_TARGET_TRIPLET": "x64-windows"
      }
    }
  ],

  "buildPresets": [
    { "name": "dev-linux",       "configurePreset": "dev-linux" },
    { "name": "release-linux",   "configurePreset": "release-linux" },
    { "name": "ci-ninja",        "configurePreset": "ci-ninja" },

    { "name": "vs2022-win64-Debug",   "configurePreset": "vs2022-win64", "configuration": "Debug" },
    { "name": "vs2022-win64-Release", "configurePreset": "vs2022-win64", "configuration": "Release" },

    { "name": "ninja-win64-Debug",    "configurePreset": "ninja-win64",  "configuration": "Debug" },
    { "name": "ninja-win64-Release",  "configurePreset": "ninja-win64",  "configuration": "Release" }
  ],

  "testPresets": [
    {
      "name": "test-dev",
      "configurePreset": "dev-linux",
      "output": { "outputOnFailure": true },
      "execution": { "noTestsAction": "error" }
    },
    {
      "name": "test-ci",
      "configurePreset": "ci-ninja",
      "output": { "outputOnFailure": true }
    },
    {
      "name": "test-win",
      "configurePreset": "vs2022-win64",
      "configuration": "Debug",
      "output": { "outputOnFailure": true }
    }
  ]
}
